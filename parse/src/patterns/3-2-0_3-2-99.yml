# Captures:
#   ver: version / release (i.e. "3.1.1")
#   plat: platform (i.e. ".NET"
#   os: OS (i.e. "Microsoft Windows 10.0.22621")
#   build: build number (i.e. "3" for 3.1.1-3)
#   commit: combined commit string (i.e. "d8a2f91+3050eba")
platforms:
  # Vanilla
  - version: "---- CouchbaseLite/(?<ver>\\d+.\\d+.\\d+).+\\((?<plat>\\S+); (?<os>.*)\\) Build/(?<build>\\d+) LiteCore/\\d+.\\d+.\\d+ \\(\\d+\\) Commit/(?<commit>\\S+) ----"
    timestamp: "(?<ts>\\d{2}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d+)"
    timestamp_formats:
      - "%Y-%m-%dT%H:%M:%S.%6f"
    domain: "\\d{2}:\\d{2}:\\d{2}.\\d+ (?<domain>\\S+) "
    level: "\\d{2}:\\d{2}:\\d{2}.\\d+ \\S+ (?<level>\\S+) "
    level_names:
      error: "Error"
      warn: "Warning"
      info: "Info"
      verbose: "Verbose"
      debug: "Debug"
  # Android Logcat
  - version: "Initialized: CouchbaseLite (?<plat>\\S+) v(?<ver>\\d+.\\d+.\\d+)-(?<build>\\d+).*Commit/(?<commit>\\S+).* on \\S+; (?<os>.*);"
    timestamp: "(?<ts>\\d{2}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d+)"
    timestamp_formats:
      - "%Y-%m-%dT%H:%M:%S.%6f"
    domain: "\\d{2}:\\d{2}:\\d{2}.\\d+ (?<domain>\\S+) "
    level: "\\d{2}:\\d{2}:\\d{2}.\\d+ \\S+ (?<level>\\S+) "
    level_names:
      error: "E"
      warn: "W"
      info: "I"
      verbose: "V"
      debug: "D"
  # LiteCore CppTest binary logs
  - version: "---- .*/(?<ver>\\d+\\.\\d+(.\\d+)?)"
    timestamp: "(?<ts>\\d{2}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d+)"
    timestamp_formats:
      - "%Y-%m-%dT%H:%M:%S.%6f"
    domain: "\\d{2}:\\d{2}:\\d{2}.\\d+ (?<domain>\\S+) "
    level: "\\d{2}:\\d{2}:\\d{2}.\\d+ \\S+ (?<level>\\S+) "
    level_names:
      error: "Error"
      warn: "Warning"
      info: "Info"
      verbose: "Verbose"
      debug: "Debug"
# Captures
#   obj: Object name (i.e. "Repl")
#   id: Object ID
#   parents: Parent objects string (i.e. "Repl#1/Pusher#2/")
object: "Obj=/(apiTest/)?(?<parents>(\\w+#\\d+/)*)(?<obj>\\w+)#(?<id>\\d+)/"

events:
  db_open:
    regex: "Opening database"
  db_upgrade:
    regex: "SCHEMA UPGRADE \\((?<old_ver>\\d+)-(?<new_ver>\\d+)\\)"
    captures:
      old_ver: Int # Old schema version
      new_ver: Int # New schema version
  db_tx_begin:
    regex: "begin transaction"
  db_tx_commit:
    regex: "commit transaction"
  db_tx_abort:
    regex: "abort transaction"
  db_saved_rev:
    regex: "Saved '(?<doc_id>\\S+)' rev (?<rev_id>\\S+) as seq (?<sequence>\\d+)"
    captures:
      doc_id: String # Document ID
      rev_id: String # Revision ID
      sequence: Int # Sequence number
  housekeeper_monitor:
    regex: "Housekeeper: opening background database"
  repl_conflict_scan:
    regex: "Found (?<num_conflicts>\\d+) conflicted docs in"
    captures:
      num_conflicts: Int # Number of conflicts
  repl_connected:
    regex: "Connected!"
  repl_activity_update:
    regex: "activityLevel=(?<activity>\\S+): connectionState=(?<connection_state>\\d), savingChkpt=(?<saving_checkpoint>\\d+)"
    captures:
      activity: String # Activity level
      connection_state: Int # BLIP Connection state
      saving_checkpoint: Bool # Whether the repl needs to save a checkpoint
  repl_status_update:
    regex: "pushStatus=(?<push_status>\\S+), pullStatus=(?<pull_status>\\S+), progress=(?<completed>\\d+)/(?<total>\\d+)/(?<doc_count>\\d+)"
    captures:
      push_status: String # Push status
      pull_status: String # Pull status
      completed: Int # Number of completed items
      total: Int # Total number of items
      doc_count: Int # Number of documents
  subrepl_start:
    regex: "Starting (?<mode>\\w+) from remote seq '(?<sequence>\\d+)'"
    captures:
      mode: String # Replication mode ('push' or 'pull')
      sequence: Int # Sequence number
  puller_handled_revs:
    regex: "(?<handled>\\d+) revs were provisionally handled; down to (?<pending>\\d+) revs"
    captures:
      handled: Int # Number of handled revisions
      pending: Int # Number of pending revisions
  inserter_insert_rev:
    regex: "\\{'(?<doc_id>\\S+) \\((?<collection>\\S+)\\)' #(?<rev_id>\\S+) <- (?<rev_history>\\S+)\\} seq (?<sequence>\\d+)"
    captures:
      doc_id: String # Document ID
      collection: String # Collection name
      rev_id: String # Revision ID
      rev_history: String # Revision history
      sequence: Int # Sequence number
  blip_send_request_start:
    regex: "Sending '(?<request>\\w+)' REQ #(?<id>\\d+)"
    captures:
      request: String # Request type
      id: Int # Request ID
  blip_queue_request:
    regex: "Requeuing REQ #(?<id>\\d+)"
    captures:
      id: Int # Request ID
  blip_ws_write_start:
    regex: "Starting writeToWebSocket loop..."
  blip_send_frame:
    regex: "Sending frame: (?<message_type>\\w+) #(?<id>\\d+) (?<more_coming>M|-)(?<urgent>U|-)(?<no_reply>N|-)(?<compressed>C|-), bytes (?<from_byte>\\d+)--(?<to_byte>\\d+)"
    captures:
      message_type: String # Message type
      id: Int # Message ID
      more_coming: Char # More frames coming
      urgent: Char # Urgent message
      no_reply: Char # No reply expected
      compressed: Char # Compressed message
      from_byte: Int # Starting byte
      to_byte: Int # Ending byte
  blip_send_request_end:
    regex: "Finished sending REQ #(?<id>\\d+)"
    captures:
      id: Int # Request ID
  blip_ws_write_end:
    regex: "...Wrote (?<bytes>\\d+) bytes to WebSocket \\(writeable=(?<writeable>\\d)\\)"
    captures:
      bytes: Int # Number of bytes written
      writeable: Bool # Whether the WebSocket is writeable
  blip_receive_frame:
    regex: "Received frame: (?<message_type>\\w+) #(?<id>\\d+) (?<more_coming>M|-)(?<urgent>U|-)(?<no_reply>N|-)(?<compressed>C|-), length\\s+(?<length>\\d+)"
    captures:
      message_type: String # Message type
      id: Int # Message ID
      more_coming: Char # More frames coming
      urgent: Char # Urgent message
      no_reply: Char # No reply expected
      compressed: Char # Compressed message
      length: Int # Message length
